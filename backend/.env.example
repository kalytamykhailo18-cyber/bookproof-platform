# ============================================
# BookProof Backend - Environment Variables
# ============================================

# ============================================
# APPLICATION
# ============================================
NODE_ENV=development
APP_NAME=BookProof
API_URL=http://localhost:4000
PORT=4000

# ============================================
# DATABASE (Neon PostgreSQL)
# ============================================
# Connection pool settings for scalability:
# - pgbouncer=true: Use PgBouncer for connection pooling (recommended for serverless)
# - connection_limit: Set based on expected concurrent users
#   - Development: 10
#   - Production: 25-50 (adjust based on workload)
# - pool_timeout: Time to wait for connection (default: 10s)
DATABASE_URL="postgresql://user:password@host:5432/bookproof?pgbouncer=true&connection_limit=25&pool_timeout=20"
DIRECT_DATABASE_URL="postgresql://user:password@host:5432/bookproof"

# ============================================
# JWT AUTHENTICATION
# Per requirements.md Section 15.1: Session timeout 24 hours (configurable)
# ============================================
JWT_SECRET=your-jwt-secret-here-min-32-chars
JWT_EXPIRES_IN=24h

# ============================================
# STRIPE PAYMENTS
# ============================================
STRIPE_SECRET_KEY=sk_test_xxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxx

# Package Price IDs
STRIPE_PRICE_25=price_xxxxx
STRIPE_PRICE_50=price_xxxxx
STRIPE_PRICE_100=price_xxxxx
STRIPE_PRICE_250=price_xxxxx
STRIPE_PRICE_500=price_xxxxx
STRIPE_PRICE_1000=price_xxxxx

# Keyword Research Price
STRIPE_PRICE_KEYWORD_RESEARCH=price_xxxxx

# Subscription Price (if applicable)
STRIPE_PRICE_SUBSCRIPTION=price_xxxxx

# ============================================
# FILE STORAGE (Cloudflare R2)
# ============================================
R2_ACCESS_KEY_ID=your-access-key-id
R2_SECRET_ACCESS_KEY=your-secret-access-key
R2_ENDPOINT=https://your-account-id.r2.cloudflarestorage.com
R2_BUCKET=bookproof-files
R2_PUBLIC_BASE_URL=https://files.bookproof.app
R2_REGION=auto

# File size limits (in MB)
MAX_EBOOK_SIZE_MB=100
MAX_AUDIOBOOK_SIZE_MB=500

# Signed URL expiration (in seconds)
AUDIOBOOK_ACCESS_DURATION=604800  # 7 days

# ============================================
# EMAIL (Resend)
# ============================================
RESEND_API_KEY=re_xxxxx
RESEND_FROM_EMAIL=noreply@bookproof.app
RESEND_FROM_NAME=BookProof

# Email addresses for notifications
ADMIN_EMAIL=admin@bookproof.app
SUPPORT_EMAIL=support@bookproof.app

# ============================================
# REDIS (Upstash)
# ============================================
REDIS_URL=redis://default:xxxxx@xxxxx.upstash.io:6379
REDIS_TOKEN=xxxxx

# BullMQ Queue Settings
QUEUE_CONCURRENCY=5
QUEUE_MAX_RETRIES=3

# ============================================
# ERROR MONITORING (Sentry)
# ============================================
SENTRY_DSN=https://xxxxx@xxxxx.ingest.sentry.io/xxxxx
SENTRY_AUTH_TOKEN=xxxxx
SENTRY_ORG=your-org
SENTRY_PROJECT=bookproof

# Sample rate (0.0 to 1.0)
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_REPLAYS_SAMPLE_RATE=0.1

# ============================================
# LOGGING
# ============================================
LOG_LEVEL=info
LOG_FORMAT=json

# ============================================
# SECURITY
# ============================================
# CORS
CORS_ORIGIN=http://localhost:3000,https://bookproof.app
CORS_CREDENTIALS=true

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000  # 15 minutes
RATE_LIMIT_MAX_REQUESTS=100

# Password
PASSWORD_MIN_LENGTH=8
PASSWORD_SALT_ROUNDS=10

# Session
SESSION_MAX_AGE=604800  # 7 days in seconds

# ============================================
# BUSINESS RULES
# ============================================
# Credit System
EBOOK_CREDIT_VALUE=1
AUDIOBOOK_CREDIT_VALUE=2

# Activation Windows (in days)
SMALL_PACKAGE_VALIDITY_DAYS=30
MEDIUM_PACKAGE_VALIDITY_DAYS=90
LARGE_PACKAGE_VALIDITY_DAYS=120

# Queue & Assignment
OVERBOOKING_PERCENTAGE=20
ASSIGNMENT_DEADLINE_HOURS=72
READER_SELECTION_POOL_SIZE=50

# Reminders (in hours before deadline)
REMINDER_24H=24
REMINDER_48H=48
REMINDER_72H=72

# Amazon Monitoring
AMAZON_GUARANTEE_DAYS=14
AMAZON_CHECK_INTERVAL_HOURS=24

# Affiliate Commission
AFFILIATE_COMMISSION_PERCENTAGE=20
AFFILIATE_COOKIE_DAYS=30

# Reader Wallet (Section 3.9: $50 minimum payout)
MINIMUM_PAYOUT_AMOUNT=50.00

# ============================================
# FEATURE FLAGS
# ============================================
FEATURE_SUBSCRIPTIONS=false
FEATURE_KEYWORD_RESEARCH=true
FEATURE_AFFILIATE_PROGRAM=true
FEATURE_AUDIOBOOK=true

# ============================================
# SCALABILITY & PERFORMANCE
# ============================================
# Cache TTL (in seconds)
CACHE_DEFAULT_TTL=300

# Request timeout (in milliseconds)
REQUEST_TIMEOUT_MS=30000

# File upload timeout for large files (in milliseconds)
FILE_UPLOAD_TIMEOUT_MS=600000  # 10 minutes for 500MB audiobooks

# Maximum concurrent file uploads
MAX_CONCURRENT_UPLOADS=5

# ============================================
# DEVELOPMENT ONLY
# ============================================
# Debug
DEBUG=false
VERBOSE_LOGGING=false

# Bypass certain checks in dev
SKIP_EMAIL_VERIFICATION=false
SKIP_STRIPE_WEBHOOK_SIGNATURE=false

# Seed data
SEED_DATABASE=false
